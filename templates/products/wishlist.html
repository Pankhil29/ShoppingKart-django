{% extends 'base.html' %}
{% block content %}

<style>
    :root {
        --primary: #7C3AED;
        --primary-hover: #6D28D9;
        --bg-light: #F9FAFB;
        --white: #FFFFFF;
        --primary-border: #beaadf;
    }

    .wishlist-card {
        border: 1px solid var(--primary-border);
        border-radius: 12px;
        background: var(--white);
        transition: all 0.3s ease;
        position: relative;
        height: 100%;
    }

    .wishlist-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(124, 58, 237, 0.1);
        border-color: var(--primary);
    }

    .product-img-container {
        height: 200px;
        overflow: hidden;
        border-radius: 12px 12px 0 0;
        background: #fdfdfd;
    }

    .product-img-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .remove-wishlist {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.9);
        color: #ef4444;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: 0.2s;
        z-index: 10;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .remove-wishlist:hover {
        background: #ef4444;
        color: white;
    }

    .btn-view-product {
        background-color: var(--primary);
        color: white;
        border-radius: 8px;
        width: 100%;
        font-weight: 500;
        border: none;
        padding: 8px;
    }

    .btn-view-product:hover {
        background-color: var(--primary-hover);
        color: white;
    }

    .price-tag {
        color: var(--primary);
        font-weight: 700;
        font-size: 1.1rem;
    }
</style>

<div class="container-fluid min-vh-100" style="background-color: var(--bg-light);">
    <div class="row min-vh-100">
        {% include 'components/profileSidebar.html' %}

        <div class="col-lg-9 col-md-8 p-lg-5 p-3">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="mb-0" style="color: var(--text-dark); font-weight: 700;">My Wishlist</h3>
                <span class="badge px-3 py-2" style="background-color: var(--primary);">{{ products|length }}
                    Items</span>
            </div>

            {% if products %}
            <div class="row g-4">
                {% for product in products %}
                <div class="col-xl-4 col-md-6" id="product-card-{{ product.id }}">
                    <div class="card wishlist-card border-0 shadow-sm">
                        <button class="remove-wishlist" onclick="toggleWishlist('{{ product.id }}')">
                            <i class="bi bi-trash"></i>
                        </button>

                        <div class="product-img-container">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.product_name }}">
                            {% else %}
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                            </div>
                            {% endif %}
                        </div>

                        <div class="card-body">
                            <h6 class="text-truncate mb-1" title="{{ product.product_name }}">{{ product.product_name }}
                            </h6>
                            <p class="text-muted small mb-2">{{ product.category.category_name }}</p>

                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="price-tag">â‚¹{{ product.min_price|floatformat:2 }}</span>
                                {% if not product.is_available %}
                                <span class="badge bg-danger">Out of Stock</span>
                                {% endif %}
                            </div>

                            <a href="{% url 'product_details_page' product.slug %}" class="btn btn-view-product">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="card border-0 shadow-sm p-5 text-center" style="border-radius: 12px;">
                <div class="mb-3">
                    <i class="bi bi-heart text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
                </div>
                <h5>Your wishlist is empty</h5>
                <p class="text-muted">Save items you like to find them easily later.</p>
                <a href="{% url 'product_list' %}" class="btn btn-primary px-4 py-2 mx-auto mt-2"
                    style="background-color: var(--primary); border: none;">Explore Products</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function toggleWishlist(productId) {
        fetch(`/wishlist_page/?id=${productId}`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'removed') {
                    const element = document.getElementById(`product-card-${productId}`);
                    element.style.opacity = '0';
                    setTimeout(() => {
                        element.remove();
                        // Agar koi product na bache toh page reload kar do empty state dikhane ke liye
                        if (document.querySelectorAll('.wishlist-card').length === 0) {
                            location.reload();
                        }
                    }, 300);
                }
            });
    }
</script>

{% endblock %}